{"ast":null,"code":"import _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// application\nimport { getActiveFilters, getResetValue, hasHandler } from '~/services/filters';\nimport { SHOP_NAMESPACE } from '~/store/shop/shopTypes';\nimport { SHOP_FETCH_CATEGORY_SUCCESS, SHOP_FETCH_PRODUCTS_LIST_START, SHOP_FETCH_PRODUCTS_LIST_SUCCESS, SHOP_HYDRATE, SHOP_INIT, SHOP_RESET_FILTER, SHOP_RESET_FILTERS, SHOP_SET_FILTER_VALUE, SHOP_SET_OPTION_VALUE } from '~/store/shop/shopActionTypes';\nvar initialState = {\n  init: false,\n  categorySlug: null,\n  categoryIsLoading: true,\n  category: null,\n  productsListIsLoading: true,\n  productsList: null,\n  options: {},\n  filters: {},\n  activeFilters: [],\n  removedFilters: [],\n  currentFilters: []\n};\n\nfunction shopReducerFetchProductsListSuccess(state, action) {\n  var activeFilters = action.productsList.filters.filter(function (x) {\n    return hasHandler(x);\n  }).reduce(function (acc, filter) {\n    return [].concat(_toConsumableArray(acc), _toConsumableArray(getActiveFilters(filter)));\n  }, []);\n  console.log(action.productsList);\n  return _objectSpread(_objectSpread({}, state), {}, {\n    productsListIsLoading: false,\n    productsList: action.productsList,\n    activeFilters: activeFilters,\n    removedFilters: [],\n    currentFilters: activeFilters\n  });\n}\n\nfunction shopReducerSetFilterValue(state, action) {\n  var currentFilters = _objectSpread({}, state.filters);\n\n  var filters;\n\n  if (action.value !== null) {\n    filters = _objectSpread(_objectSpread({}, currentFilters), {}, _defineProperty({}, action.filter, action.value));\n  } else {\n    delete currentFilters[action.filter];\n    filters = _objectSpread({}, currentFilters);\n  }\n\n  return _objectSpread(_objectSpread({}, state), {}, {\n    options: _objectSpread(_objectSpread({}, state.options), {}, {\n      page: 1\n    }),\n    filters: filters\n  });\n}\n\nfunction shopReducerResetFilter(state, action) {\n  if (!hasHandler(action.activeFilter.original)) {\n    return state;\n  }\n\n  var removedFilters = state.removedFilters;\n\n  if (!removedFilters.includes(action.activeFilter)) {\n    removedFilters = [].concat(_toConsumableArray(removedFilters), [action.activeFilter]);\n  }\n\n  var currentFilters = state.currentFilters;\n\n  if (currentFilters.includes(action.activeFilter)) {\n    currentFilters = currentFilters.filter(function (x) {\n      return x !== action.activeFilter;\n    });\n  } // All removed filters with the same slug.\n\n\n  var all = removedFilters.filter(function (x) {\n    return x.original.slug === action.activeFilter.original.slug;\n  });\n  var value = getResetValue(all); // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n  var _state$filters = state.filters,\n      _action$activeFilter$ = action.activeFilter.original.slug,\n      _ = _state$filters[_action$activeFilter$],\n      filters = _objectWithoutProperties(_state$filters, [_action$activeFilter$].map(_toPropertyKey));\n\n  if (value !== null) {\n    filters[action.activeFilter.original.slug] = value;\n  }\n\n  return _objectSpread(_objectSpread({}, state), {}, {\n    options: _objectSpread(_objectSpread({}, state.options), {}, {\n      page: 1\n    }),\n    filters: filters,\n    removedFilters: removedFilters,\n    currentFilters: currentFilters\n  });\n}\n\nfunction shopReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case SHOP_HYDRATE:\n      return action.payload[SHOP_NAMESPACE];\n\n    case SHOP_INIT:\n      return _objectSpread(_objectSpread({}, initialState), {}, {\n        categorySlug: action.categorySlug,\n        options: action.options,\n        filters: action.filters\n      });\n\n    case SHOP_FETCH_CATEGORY_SUCCESS:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        init: true,\n        categoryIsLoading: false,\n        category: action.category\n      });\n\n    case SHOP_FETCH_PRODUCTS_LIST_START:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        productsListIsLoading: true\n      });\n\n    case SHOP_FETCH_PRODUCTS_LIST_SUCCESS:\n      return shopReducerFetchProductsListSuccess(state, action);\n\n    case SHOP_SET_OPTION_VALUE:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        options: _objectSpread(_objectSpread({}, state.options), {}, _defineProperty({\n          page: 1\n        }, action.option, action.value))\n      });\n\n    case SHOP_SET_FILTER_VALUE:\n      return shopReducerSetFilterValue(state, action);\n\n    case SHOP_RESET_FILTERS:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        options: _objectSpread(_objectSpread({}, state.options), {}, {\n          page: 1\n        }),\n        filters: {}\n      });\n\n    case SHOP_RESET_FILTER:\n      return shopReducerResetFilter(state, action);\n\n    default:\n      return state;\n  }\n}\n\nexport default shopReducer;","map":null,"metadata":{},"sourceType":"module"}