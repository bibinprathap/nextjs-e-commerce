{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// react\nimport React, { useEffect, useRef, useState } from 'react'; // third-party\n\nimport classNames from 'classnames';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { toast } from 'react-toastify';\nimport { useForm } from 'react-hook-form'; // application\n\nimport ReviewsList from '~/components/shop/ReviewsList';\nimport { shopApi } from '~/api';\nimport { useAsyncAction, useIsUnmountedRef } from '~/store/hooks';\nimport { validateEmail } from '~/services/validators';\n\nfunction ReviewsView(props) {\n  var _errors$rating, _errors$author, _errors$email, _errors$email2, _errors$content;\n\n  var intl = useIntl();\n  var productId = props.productId,\n      productPageLayout = props.productPageLayout;\n\n  var _useState = useState(1),\n      page = _useState[0],\n      setPage = _useState[1];\n\n  var listMetaRef = useRef(null);\n\n  var _useState2 = useState(null),\n      list = _useState2[0],\n      setList = _useState2[1];\n\n  var formMethods = useForm();\n  var handleSubmit = formMethods.handleSubmit,\n      register = formMethods.register,\n      errors = formMethods.errors,\n      reset = formMethods.reset;\n  var isUnmountedRef = useIsUnmountedRef();\n\n  var load = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(productId, page, canceledRef) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return shopApi.getProductReviews(productId, {\n                limit: 8,\n                page: page\n              }).then(function (result) {\n                if (isUnmountedRef.current || (canceledRef === null || canceledRef === void 0 ? void 0 : canceledRef.current)) {\n                  return;\n                }\n\n                listMetaRef.current = {\n                  productId: productId,\n                  page: page\n                };\n                setList(result);\n                setPage(result.page);\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function load(_x, _x2, _x3) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var _listMetaRef$current, _listMetaRef$current2;\n\n    var canceledRef = {\n      current: false\n    };\n\n    if (productId !== ((_listMetaRef$current = listMetaRef.current) === null || _listMetaRef$current === void 0 ? void 0 : _listMetaRef$current.productId) || page !== ((_listMetaRef$current2 = listMetaRef.current) === null || _listMetaRef$current2 === void 0 ? void 0 : _listMetaRef$current2.page)) {\n      load(productId, page, canceledRef).then();\n    }\n\n    return function () {\n      canceledRef.current = true;\n    };\n  }, [productId, page]);\n\n  var _useAsyncAction = useAsyncAction( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return shopApi.addProductReview(productId, _objectSpread(_objectSpread({}, data), {}, {\n                rating: parseFloat(data.rating)\n              }));\n\n            case 2:\n              _context2.next = 4;\n              return load(productId, 1);\n\n            case 4:\n              if (!isUnmountedRef.current) {\n                _context2.next = 6;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 6:\n              reset();\n              toast.success(intl.formatMessage({\n                id: 'TEXT_TOAST_REVIEW_ADDED'\n              }));\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [productId, reset]),\n      _useAsyncAction2 = _slicedToArray(_useAsyncAction, 2),\n      submit = _useAsyncAction2[0],\n      submitInProgress = _useAsyncAction2[1];\n\n  return __jsx(\"div\", {\n    className: \"reviews-view\"\n  }, list && __jsx(\"div\", {\n    className: \"reviews-view__list\"\n  }, __jsx(ReviewsList, {\n    list: list,\n    page: page,\n    onPageChange: setPage\n  })), __jsx(\"form\", {\n    className: \"reviews-view__form\",\n    onSubmit: handleSubmit(submit)\n  }, __jsx(\"h3\", {\n    className: \"reviews-view__header\"\n  }, __jsx(FormattedMessage, {\n    id: \"HEADER_WRITE_REVIEW\"\n  })), __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: classNames({\n      'col-xxl-8 col-xl-10 col-lg-9 col-12': productPageLayout === 'full',\n      'col-xxl-12 col-xl-10 col-12': productPageLayout === 'sidebar'\n    })\n  }, __jsx(\"div\", {\n    className: \"form-row\"\n  }, __jsx(\"div\", {\n    className: \"form-group col-md-4\"\n  }, __jsx(\"label\", {\n    htmlFor: \"review-stars\"\n  }, __jsx(FormattedMessage, {\n    id: \"INPUT_RATING_LABEL\"\n  })), __jsx(\"select\", {\n    id: \"review-stars\",\n    name: \"rating\",\n    className: classNames('form-control', {\n      'is-invalid': errors.rating\n    }),\n    ref: register({\n      required: true\n    })\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, intl.formatMessage({\n    id: 'INPUT_RATING_PLACEHOLDER'\n  })), [5, 4, 3, 2, 1].map(function (stars) {\n    return __jsx(\"option\", {\n      key: stars,\n      value: stars\n    }, intl.formatMessage({\n      id: 'INPUT_RATING_OPTION'\n    }, {\n      stars: stars\n    }));\n  })), __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, ((_errors$rating = errors.rating) === null || _errors$rating === void 0 ? void 0 : _errors$rating.type) === 'required' && __jsx(FormattedMessage, {\n    id: \"ERROR_FORM_REQUIRED\"\n  }))), __jsx(\"div\", {\n    className: \"form-group col-md-4\"\n  }, __jsx(\"label\", {\n    htmlFor: \"review-author\"\n  }, __jsx(FormattedMessage, {\n    id: \"INPUT_YOUR_NAME_LABEL\"\n  })), __jsx(\"input\", {\n    type: \"text\",\n    id: \"review-author\",\n    name: \"author\",\n    className: classNames('form-control', {\n      'is-invalid': errors.author\n    }),\n    placeholder: intl.formatMessage({\n      id: 'INPUT_YOUR_NAME_PLACEHOLDER'\n    }),\n    ref: register({\n      required: true\n    })\n  }), __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, ((_errors$author = errors.author) === null || _errors$author === void 0 ? void 0 : _errors$author.type) === 'required' && __jsx(FormattedMessage, {\n    id: \"ERROR_FORM_REQUIRED\"\n  }))), __jsx(\"div\", {\n    className: \"form-group col-md-4\"\n  }, __jsx(\"label\", {\n    htmlFor: \"review-email\"\n  }, __jsx(FormattedMessage, {\n    id: \"INPUT_EMAIL_ADDRESS_LABEL\"\n  })), __jsx(\"input\", {\n    type: \"text\",\n    id: \"review-email\",\n    name: \"email\",\n    className: classNames('form-control', {\n      'is-invalid': errors.email\n    }),\n    placeholder: intl.formatMessage({\n      id: 'INPUT_EMAIL_ADDRESS_PLACEHOLDER'\n    }),\n    ref: register({\n      required: true,\n      validate: {\n        email: validateEmail\n      }\n    })\n  }), __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, ((_errors$email = errors.email) === null || _errors$email === void 0 ? void 0 : _errors$email.type) === 'required' && __jsx(FormattedMessage, {\n    id: \"ERROR_FORM_REQUIRED\"\n  }), ((_errors$email2 = errors.email) === null || _errors$email2 === void 0 ? void 0 : _errors$email2.type) === 'email' && __jsx(FormattedMessage, {\n    id: \"ERROR_FORM_INCORRECT_EMAIL\"\n  })))), __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"label\", {\n    htmlFor: \"review-text\"\n  }, __jsx(FormattedMessage, {\n    id: \"INPUT_YOUR_REVIEW_LABEL\"\n  })), __jsx(\"textarea\", {\n    id: \"review-text\",\n    rows: 6,\n    name: \"content\",\n    className: classNames('form-control', {\n      'is-invalid': errors.content\n    }),\n    placeholder: intl.formatMessage({\n      id: 'INPUT_YOUR_REVIEW_PLACEHOLDER'\n    }),\n    ref: register({\n      required: true\n    })\n  }), __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, ((_errors$content = errors.content) === null || _errors$content === void 0 ? void 0 : _errors$content.type) === 'required' && __jsx(FormattedMessage, {\n    id: \"ERROR_FORM_REQUIRED\"\n  }))), __jsx(\"div\", {\n    className: \"form-group mb-0 mt-4\"\n  }, __jsx(\"button\", {\n    type: \"submit\",\n    className: classNames('btn', 'btn-primary', {\n      'btn-loading': submitInProgress\n    })\n  }, __jsx(FormattedMessage, {\n    id: \"BUTTON_POST_REVIEW\"\n  })))))));\n}\n\nexport default ReviewsView;","map":null,"metadata":{},"sourceType":"module"}