{"ast":null,"code":"/* eslint-disable import/prefer-default-export */\n// application\nimport { delayResponse } from '~/fake-server/utils';\nimport { products } from '~/fake-server/database/products';\nimport { getNextOrderId, getNextOrderNumber, getOrderToken, orders } from '~/fake-server/database/orders';\nexport function checkout(data) {\n  const id = getNextOrderId();\n  const items = data.items.map(x => {\n    const product = products.find(p => p.id === x.productId);\n\n    if (!product) {\n      throw new Error('Product not found');\n    }\n\n    return {\n      product,\n      options: x.options,\n      price: product.price,\n      quantity: x.quantity,\n      total: product.price * x.quantity\n    };\n  });\n  const quantity = items.reduce((acc, x) => acc + x.quantity, 0);\n  const subtotal = items.reduce((acc, x) => acc + x.total, 0);\n  const totals = [{\n    title: 'SHIPPING',\n    price: 25\n  }, {\n    title: 'TAX',\n    price: subtotal * 0.20\n  }];\n  const total = subtotal + totals.reduce((acc, x) => acc + x.price, 0);\n  const date = new Date();\n\n  const pad = v => `00${v}`.substr(-2);\n\n  const createdAt = `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}`;\n  const order = {\n    id,\n    token: getOrderToken(id),\n    number: getNextOrderNumber(),\n    createdAt,\n    payment: data.payment,\n    status: 'PENDING',\n    items,\n    quantity,\n    subtotal,\n    totals,\n    total,\n    billingAddress: data.billingAddress,\n    shippingAddress: data.shippingAddress\n  };\n  debugger;\n  fetch('/api/send-email', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(order)\n  });\n  orders.unshift(order);\n  console.log(order);\n  debugger;\n  return delayResponse(Promise.resolve(order));\n}","map":null,"metadata":{},"sourceType":"module"}