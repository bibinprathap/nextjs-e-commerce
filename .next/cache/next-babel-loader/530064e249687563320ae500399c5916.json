{"ast":null,"code":"/* eslint-disable import/prefer-default-export */\n// application\nimport { delayResponse } from '~/fake-server/utils';\nimport { products } from '~/fake-server/database/products';\nimport { getNextOrderId, getNextOrderNumber, getOrderToken, orders } from '~/fake-server/database/orders';\nexport function checkout(data) {\n  var id = getNextOrderId();\n  var items = data.items.map(function (x) {\n    var product = products.find(function (p) {\n      return p.id === x.productId;\n    });\n\n    if (!product) {\n      throw new Error('Product not found');\n    }\n\n    return {\n      product: product,\n      options: x.options,\n      price: product.price,\n      quantity: x.quantity,\n      total: product.price * x.quantity\n    };\n  });\n  var quantity = items.reduce(function (acc, x) {\n    return acc + x.quantity;\n  }, 0);\n  var subtotal = items.reduce(function (acc, x) {\n    return acc + x.total;\n  }, 0);\n  var totals = [{\n    title: 'SHIPPING',\n    price: 25\n  }, {\n    title: 'TAX',\n    price: subtotal * 0.20\n  }];\n  var total = subtotal + totals.reduce(function (acc, x) {\n    return acc + x.price;\n  }, 0);\n  var date = new Date();\n\n  var pad = function pad(v) {\n    return \"00\".concat(v).substr(-2);\n  };\n\n  var createdAt = \"\".concat(date.getFullYear(), \"-\").concat(pad(date.getMonth() + 1), \"-\").concat(pad(date.getDate()));\n  var order = {\n    id: id,\n    token: getOrderToken(id),\n    number: getNextOrderNumber(),\n    createdAt: createdAt,\n    payment: data.payment,\n    status: 'PENDING',\n    items: items,\n    quantity: quantity,\n    subtotal: subtotal,\n    totals: totals,\n    total: total,\n    billingAddress: data.billingAddress,\n    shippingAddress: data.shippingAddress\n  };\n  debugger;\n  fetch('/api/send-email', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(order)\n  });\n  orders.unshift(order);\n  console.log(order);\n  debugger;\n  return delayResponse(Promise.resolve(order));\n}","map":null,"metadata":{},"sourceType":"module"}